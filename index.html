<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EtherSniper | Quantum AI</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <!-- Biblioteca T√©cnica (C√©rebro Matem√°tico) -->
    <script src="https://cdn.jsdelivr.net/npm/technicalindicators@3.1.0/dist/browser.js"></script>
    
    <style>
        body { background-color: #0b0e11; color: #eaecef; font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; text-align: center; padding: 20px; margin: 0; }
        .header { margin-bottom: 30px; border-bottom: 1px solid #333; padding-bottom: 20px; }
        h1 { color: #f0b90b; margin: 0; display: flex; align-items: center; justify-content: center; gap: 10px; font-size: 1.5rem; }
        .subtitle { color: #848e9c; font-size: 0.9em; margin-top: 5px; }
        
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 15px; max-width: 1000px; margin: 0 auto; }
        
        .card { background: #1e2329; padding: 20px; border-radius: 12px; border: 1px solid #333; text-align: left; position: relative; transition: transform 0.2s; box-shadow: 0 4px 6px rgba(0,0,0,0.3); }
        .card:hover { transform: translateY(-2px); border-color: #444; }
        
        .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .symbol { font-size: 1.3em; font-weight: bold; display: flex; align-items: center; gap: 8px; }
        .price { font-family: 'Consolas', monospace; font-size: 1.2em; color: #f0b90b; }
        
        /* SCORE DE INTELIG√äNCIA */
        .ai-score-box { background: #2b3139; padding: 10px; border-radius: 8px; margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center; }
        .score-title { font-size: 0.8em; color: #848e9c; text-transform: uppercase; }
        .score-value { font-weight: bold; font-size: 1.1em; }
        
        /* BARRAS DE CONFLU√äNCIA */
        .confluence { display: flex; gap: 5px; margin-bottom: 10px; }
        .factor { flex: 1; height: 4px; background: #444; border-radius: 2px; }
        .factor.active { background: #0ecb81; box-shadow: 0 0 5px #0ecb81; }
        
        .analysis-text { font-size: 0.85em; color: #848e9c; line-height: 1.4; border-top: 1px solid #333; padding-top: 10px; }
        .analysis-highlight { color: #eaecef; font-weight: bold; }

        /* STATUS */
        .status-badge { padding: 6px 12px; border-radius: 4px; font-weight: bold; font-size: 0.85em; text-transform: uppercase; text-align: center; width: fit-content; }
        .compra-forte { background: rgba(14, 203, 129, 0.2); color: #0ecb81; border: 1px solid #0ecb81; box-shadow: 0 0 10px rgba(14, 203, 129, 0.2); }
        .compra { background: rgba(14, 203, 129, 0.1); color: #0ecb81; border: 1px solid #0ecb81; }
        .venda { background: rgba(246, 70, 93, 0.2); color: #f6465d; border: 1px solid #f6465d; }
        .neutro { background: #2b3139; color: #848e9c; border: 1px solid #444; }
        .perigo { background: rgba(240, 185, 11, 0.1); color: #f0b90b; border: 1px solid #f0b90b; }

        /* ALARME VISUAL */
        @keyframes pulse-green { 0% { box-shadow: 0 0 0 0 rgba(14, 203, 129, 0.7); } 70% { box-shadow: 0 0 0 15px rgba(14, 203, 129, 0); } 100% { box-shadow: 0 0 0 0 rgba(14, 203, 129, 0); } }
        .alert-on { border: 2px solid #0ecb81; animation: pulse-green 2s infinite; }

        .btn-som { background: #2b3139; color: white; border: none; padding: 12px 25px; border-radius: 30px; margin-top: 20px; cursor: pointer; transition: 0.3s; font-weight: bold; }
        .btn-som:hover { background: #363c45; }
        .btn-som.ativo { background: #f0b90b; color: black; box-shadow: 0 0 10px rgba(240, 185, 11, 0.4); }
    </style>
</head>
<body>

    <div class="header">
        <h1><i class="fas fa-brain"></i> EtherSniper <span style="font-size:0.6em; background:#333; padding:2px 6px; border-radius:4px; margin-left:10px;">QUANTUM</span></h1>
        <div class="subtitle">An√°lise Algor√≠tmica de Conflu√™ncia (RSI + Bollinger + EMA + Volume)</div>
        <button id="btnSom" class="btn-som" onclick="toggleSom()"><i class="fas fa-volume-mute"></i> Ativar Alerta Sonoro</button>
    </div>

    <div id="container" class="grid">
        <div style="color: #848e9c; margin-top: 50px;">
            <i class="fas fa-circle-notch fa-spin fa-2x"></i><br><br>
            Conectando ao C√©rebro Quantitativo...
        </div>
    </div>

    <audio id="audioAlerta" src="https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3"></audio>

    <script>
        // CONFIGURA√á√ÉO DE ELITE
        // Adicione aqui as moedas que voc√™ quer que a IA analise
        const MOEDAS = [
            'BTCUSDT', 'ETHUSDT', 'SOLUSDT', 'XRPUSDT', 'BNBUSDT', 
            'ADAUSDT', 'DOGEUSDT', 'LINKUSDT', 'FETUSDT', 'RENDERUSDT'
        ];
        
        let somAtivado = false;

        function toggleSom() {
            somAtivado = !somAtivado;
            const btn = document.getElementById('btnSom');
            if (somAtivado) {
                btn.innerHTML = '<i class="fas fa-volume-up"></i> Alerta Ativado';
                btn.classList.add('ativo');
                document.getElementById('audioAlerta').play().catch(() => {});
            } else {
                btn.innerHTML = '<i class="fas fa-volume-mute"></i> Ativar Alerta Sonoro';
                btn.classList.remove('ativo');
            }
        }

        async function processarIA() {
            const container = document.getElementById('container');
            if (container.innerHTML.includes("Conectando")) container.innerHTML = '';

            // Itera sobre cada moeda para an√°lise individual
            for (const symbol of MOEDAS) {
                try {
                    // 1. DATA MINING: Pega 100 velas de 15min (Necess√°rio para EMA e Bollinger precisos)
                    const res = await fetch(`https://api.binance.com/api/v3/klines?symbol=${symbol}&interval=15m&limit=100`);
                    const dados = await res.json();

                    // Prepara arrays para a biblioteca t√©cnica
                    const closes = dados.map(k => parseFloat(k[4]));
                    const highs = dados.map(k => parseFloat(k[2]));
                    const lows = dados.map(k => parseFloat(k[3]));
                    const volumes = dados.map(k => parseFloat(k[5]));
                    
                    const precoAtual = closes[closes.length - 1];
                    const volAtual = volumes[volumes.length - 1];

                    // 2. C√ÅLCULOS MATEM√ÅTICOS (Bibliotecas Reais)
                    
                    // RSI (14)
                    const rsiInput = { values: closes, period: 14 };
                    const rsiResult = window.RSI.calculate(rsiInput);
                    const rsi = rsiResult[rsiResult.length - 1];

                    // Bollinger Bands (20, 2)
                    const bbInput = { period: 20, values: closes, stdDev: 2 };
                    const bbResult = window.BollingerBands.calculate(bbInput);
                    const bb = bbResult[bbResult.length - 1];

                    // EMA 200 (Tend√™ncia Macro) e EMA 50 (Curto)
                    const ema200Input = { period: 200, values: closes }; // Pode dar null se < 200 dados, mas ok para 100 limit
                    // Usaremos EMA 50 como refer√™ncia de tend√™ncia se 200 n√£o carregar bem com 100 candles
                    const ema50Input = { period: 50, values: closes };
                    const ema50Result = window.EMA.calculate(ema50Input);
                    const ema50 = ema50Result[ema50Result.length - 1];

                    // Volume M√©dio (20)
                    const avgVol = volumes.slice(-21, -1).reduce((a, b) => a + b, 0) / 20;

                    // 3. MOTOR DE DECIS√ÉO (CONFLU√äNCIA L√ìGICA)
                    let score = 0;
                    let analise = [];
                    let fatores = [false, false, false]; // [RSI, BB, VOL]

                    // Fator 1: RSI (Sobrevenda)
                    if (rsi < 30) {
                        score += 2;
                        analise.push("RSI extremo (Sobrevendido).");
                        fatores[0] = true;
                    } else if (rsi < 40) {
                        score += 1;
                    }

                    // Fator 2: Bollinger Bands (Pre√ßo barato estatisticamente)
                    if (precoAtual <= bb.lower) {
                        score += 2;
                        analise.push("Pre√ßo furou a Banda Inferior (Barato).");
                        fatores[1] = true;
                    }

                    // Fator 3: Volume (Dinheiro entrando)
                    if (volAtual > (avgVol * 1.5)) {
                        score += 1;
                        analise.push("Volume alto detectado (Interesse).");
                        fatores[2] = true;
                    }

                    // Fator 4: Filtro de Tend√™ncia (Prote√ß√£o)
                    let tendencia = "NEUTRA";
                    if (precoAtual < ema50) {
                        score -= 1; // Penaliza compra se estiver abaixo da m√©dia (Tend√™ncia de baixa)
                        analise.push("‚ö†Ô∏è Cuidado: Abaixo da M√©dia de 50 (Tend√™ncia Baixa).");
                        tendencia = "BAIXA";
                    } else {
                        score += 1;
                        tendencia = "ALTA";
                    }

                    // 4. VEREDITO FINAL
                    let statusBadge = `<div class="status-badge neutro">NEUTRO</div>`;
                    let cardClass = "";
                    let isAlert = false;

                    if (score >= 4) {
                        statusBadge = `<div class="status-badge compra-forte">üíé COMPRA FORTE</div>`;
                        cardClass = "alert-on";
                        isAlert = true;
                    } else if (score >= 2 && tendencia !== "BAIXA") {
                        statusBadge = `<div class="status-badge compra">üü¢ COMPRA LEVE</div>`;
                    } else if (rsi > 70) {
                        statusBadge = `<div class="status-badge venda">üî¥ VENDA</div>`;
                        analise = ["RSI esticado. Hora de realizar lucro."];
                    } else if (tendencia === "BAIXA" && score < 2) {
                        statusBadge = `<div class="status-badge perigo">üõ°Ô∏è PERIGO</div>`;
                    }

                    // 5. RENDERIZA√á√ÉO INTELIGENTE
                    // Verifica se o card j√° existe para atualizar apenas os valores (evita piscar)
                    let card = document.getElementById(`card-${symbol}`);
                    const htmlContent = `
                        <div class="card-header">
                            <div class="symbol">
                                <img src="https://raw.githubusercontent.com/spothq/cryptocurrency-icons/master/32/icon/${symbol.replace('USDT','').toLowerCase()}.png" width="24" onerror="this.style.display='none'">
                                ${symbol.replace('USDT', '')}
                            </div>
                            <div class="price">$${precoAtual.toFixed(4)}</div>
                        </div>
                        
                        <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                            ${statusBadge}
                            <div style="font-size:0.8em; color:#848e9c; align-self:center;">Score: ${score}/5</div>
                        </div>

                        <div class="ai-score-box">
                            <div>
                                <div class="score-title">RSI (14)</div>
                                <div class="score-value" style="color: ${rsi < 30 ? '#0ecb81' : (rsi > 70 ? '#f6465d' : '#eaecef')}">${rsi.toFixed(1)}</div>
                            </div>
                            <div style="text-align:center">
                                <div class="score-title">Tend√™ncia</div>
                                <div class="score-value" style="color: ${tendencia === 'ALTA' ? '#0ecb81' : '#f6465d'}">${tendencia}</div>
                            </div>
                            <div style="text-align:right">
                                <div class="score-title">Bandas</div>
                                <div class="score-value">${((precoAtual - bb.lower) / (bb.upper - bb.lower) * 100).toFixed(0)}%</div>
                            </div>
                        </div>

                        <div class="confluence">
                            <div class="factor ${fatores[0] ? 'active' : ''}" title="RSI Conflu√™ncia"></div>
                            <div class="factor ${fatores[1] ? 'active' : ''}" title="Bollinger Conflu√™ncia"></div>
                            <div class="factor ${fatores[2] ? 'active' : ''}" title="Volume Conflu√™ncia"></div>
                        </div>

                        <div class="analysis-text">
                            ${analise.length > 0 ? analise.join("<br>") : "Mercado lateral. Aguardando gatilho institucional."}
                        </div>
                    `;

                    if (card) {
                        card.className = `card ${cardClass}`;
                        card.innerHTML = htmlContent;
                    } else {
                        const newCard = document.createElement('div');
                        newCard.id = `card-${symbol}`;
                        newCard.className = `card ${cardClass}`;
                        newCard.innerHTML = htmlContent;
                        container.appendChild(newCard);
                    }

                    // Tocar Som
                    if (isAlert && somAtivado) {
                        document.getElementById('audioAlerta').play().catch(() => {});
                        if(navigator.vibrate) navigator.vibrate([500, 200, 500]);
                    }

                } catch (e) {
                    console.error("Erro processando " + symbol, e);
                }
            }
        }

        // Inicia o motor
        processarIA();
        setInterval(processarIA, 10000); // Reanalisa a cada 10 segundos
    </script>
</body>
</html>
