<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EtherSniper | Real Market AI</title>
    
    <!-- Ícones e Fontes -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <style>
        :root { --primary: #F0B90B; --bg-dark: #0B0E11; --bg-card: #1E2329; --text-main: #EAECEF; --text-sub: #848E9C; --green: #0ECB81; --red: #F6465D; --border: #2B3139; }
        body { margin: 0; font-family: 'Inter', sans-serif; background-color: var(--bg-dark); color: var(--text-main); height: 100vh; display: flex; overflow: hidden; }
        
        /* Sidebar e Layout */
        .sidebar { width: 260px; background: var(--bg-card); border-right: 1px solid var(--border); display: flex; flex-direction: column; z-index: 10; }
        .logo-area { padding: 30px; font-size: 22px; font-weight: 800; color: var(--text-main); border-bottom: 1px solid var(--border); display: flex; align-items: center; gap: 10px; }
        .logo-icon { color: var(--primary); }
        .menu { flex: 1; padding: 20px 0; }
        .menu-item { padding: 15px 30px; cursor: pointer; color: var(--text-sub); display: flex; align-items: center; gap: 15px; font-weight: 500; transition: 0.2s; }
        .menu-item:hover, .menu-item.active { background: #2B3139; color: var(--primary); border-right: 3px solid var(--primary); }
        
        .main-content { flex: 1; padding: 30px; overflow-y: auto; }
        
        /* Dashboard Cards */
        .header-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 30px; }
        .card { background: var(--bg-card); border-radius: 12px; padding: 25px; border: 1px solid var(--border); position: relative; }
        .card-label { font-size: 12px; color: var(--text-sub); text-transform: uppercase; font-weight: 600; margin-bottom: 8px; }
        .card-value { font-size: 32px; font-weight: 700; letter-spacing: -1px; }
        .card-sub { font-size: 13px; margin-top: 5px; display: flex; align-items: center; gap: 5px; }
        
        /* Tabela Real Time */
        .market-container { background: var(--bg-card); border-radius: 12px; border: 1px solid var(--border); overflow: hidden; display: flex; flex-direction: column; height: 65vh; }
        .market-header { padding: 20px 25px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; background: #252A33; }
        .table-wrapper { flex: 1; overflow-y: auto; }
        table { width: 100%; border-collapse: collapse; }
        thead th { position: sticky; top: 0; background: #1E2329; color: var(--text-sub); text-align: left; padding: 15px 25px; font-size: 12px; font-weight: 600; border-bottom: 2px solid var(--border); }
        td { padding: 12px 25px; border-bottom: 1px solid var(--border); font-size: 14px; font-weight: 500; }
        tr { transition: background 0.2s; }
        tr:hover { background: #252A33; }
        
        .coin-icon { width: 24px; height: 24px; border-radius: 50%; background: #2B3139; display: flex; align-items: center; justify-content: center; font-size: 10px; font-weight: bold; color: var(--text-sub); margin-right: 10px; }
        .badge { padding: 4px 8px; border-radius: 4px; font-size: 11px; font-weight: 700; text-transform: uppercase; }
        .badge-buy { background: rgba(14, 203, 129, 0.15); color: var(--green); }
        .badge-sell { background: rgba(246, 70, 93, 0.15); color: var(--red); }
        
        /* Cores Dinâmicas */
        .text-green { color: var(--green); }
        .text-red { color: var(--red); }
        .pulse { animation: pulse 2s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }

        /* Login */
        #login-screen { position: fixed; inset: 0; background: var(--bg-dark); z-index: 2000; display: flex; justify-content: center; align-items: center; }
        .login-box { background: var(--bg-card); padding: 40px; border-radius: 16px; width: 320px; text-align: center; border: 1px solid var(--border); box-shadow: 0 20px 50px rgba(0,0,0,0.5); }
        .login-input { width: 100%; padding: 12px; margin: 10px 0; background: #2B3139; border: 1px solid #474D57; color: white; border-radius: 4px; box-sizing: border-box; }
        .btn-login { width: 100%; padding: 12px; background: var(--primary); border: none; font-weight: 700; cursor: pointer; border-radius: 4px; margin-top: 15px; color: #000; }
    </style>
</head>
<body>

    <!-- LOGIN -->
    <div id="login-screen">
        <div class="login-box">
            <h1 style="color: var(--primary); margin: 0;"><i class="fas fa-crosshairs"></i> EtherSniper</h1>
            <p style="color: var(--text-sub); font-size: 14px; margin-bottom: 30px;">Acesso ao Mercado Real</p>
            <input type="email" id="email" class="login-input" placeholder="Admin Email">
            <input type="password" id="password" class="login-input" placeholder="Senha">
            <button class="btn-login" onclick="fazerLogin()">CONECTAR BINANCE</button>
            <p id="login-msg" style="color: var(--red); font-size: 12px; margin-top: 10px;"></p>
        </div>
    </div>

    <!-- APP -->
    <div class="sidebar" id="sidebar" style="display: none;">
        <div class="logo-area"><i class="fas fa-crosshairs logo-icon"></i> EtherSniper</div>
        <div class="menu">
            <div class="menu-item active"><i class="fas fa-chart-line"></i> Mercado Real</div>
            <div class="menu-item"><i class="fas fa-robot"></i> Estratégia IA</div>
            <div class="menu-item"><i class="fas fa-history"></i> Ordens Executadas</div>
        </div>
        <div style="padding: 20px; font-size: 12px; text-align: center; color: var(--text-sub); border-top: 1px solid var(--border);">
            <div class="pulse" style="color: var(--green); margin-bottom: 5px;">● Conexão: WebSocket</div>
            <span id="user-email">...</span>
        </div>
    </div>

    <div class="main-content" id="app-content" style="display: none;">
        
        <!-- CARDS -->
        <div class="header-grid">
            <div class="card">
                <div class="card-label">Banca Gerenciada</div>
                <div class="card-value" id="banca-display">R$ 1.500,00</div>
                <div class="card-sub" style="color: var(--text-sub)">Capital Alocado</div>
            </div>
            <div class="card">
                <div class="card-label">Performance Hoje</div>
                <div class="card-value text-green" id="lucro-display">+R$ 0,00</div>
                <div class="card-sub text-green">▲ 0.00%</div>
            </div>
            <div class="card" style="border-color: var(--primary);">
                <div class="card-label" style="color: var(--primary)">Status do Sniper</div>
                <div class="card-value" style="font-size: 24px;">Rastreando...</div>
                <div class="card-sub pulse" style="color: var(--primary)">● Analisando 120 moedas/seg</div>
            </div>
        </div>

        <!-- TABELA REAL -->
        <div class="market-container">
            <div class="market-header">
                <span style="font-weight: 700; color: white;">MERCADO AO VIVO (BINANCE STREAM)</span>
                <span style="font-size: 12px; color: var(--green);">● Atualização: <span id="ping">12ms</span></span>
            </div>
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>ATIVO</th>
                            <th>PREÇO ATUAL</th>
                            <th>VARIAÇÃO 24H</th>
                            <th>AÇÃO IA</th>
                        </tr>
                    </thead>
                    <tbody id="tabela-mercado">
                        <!-- Preenchido via WebSocket -->
                    </tbody>
                </table>
            </div>
        </div>

    </div>

    <script>
        // ===============================================
        // 1. CONFIGURAÇÃO FIREBASE (Coloque seus dados!)
        // ===============================================
        const firebaseConfig = {
            apiKey: "AIzaSyAx9DPXLOCvJmgRRKlladRC-NRbxJmj0SE",
            authDomain: "ethersniper.firebaseapp.com",
            projectId: "ethersniper",
            storageBucket: "ethersniper.firebasestorage.app",
            messagingSenderId: "68071456710",
            appId: "1:68071456710:web:053ce6921ea0de77c57cc7",
            measurementId: "G-19282VJVDM"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // ===============================================
        // 2. SISTEMA DE LOGIN
        // ===============================================
        function fazerLogin() {
            const email = document.getElementById('email').value;
            const pass = document.getElementById('password').value;
            
            auth.signInWithEmailAndPassword(email, pass)
                .then(() => iniciarApp(email))
                .catch(err => {
                    if(err.code === 'auth/user-not-found') {
                        auth.createUserWithEmailAndPassword(email, pass).then(() => iniciarApp(email));
                    } else {
                        document.getElementById('login-msg').innerText = "Erro: " + err.message;
                    }
                });
        }

        // ===============================================
        // 3. MOTOR REAL (BINANCE WEBSOCKET)
        // ===============================================
        let banca = 1500.00;
        let lucro = 0;
        let ws; // WebSocket
        let moedasMap = new Map(); // Mapa para guardar estado das moedas

        function iniciarApp(email) {
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('sidebar').style.display = 'flex';
            document.getElementById('app-content').style.display = 'block';
            document.getElementById('user-email').innerText = email;

            conectarBinance();
        }

        function conectarBinance() {
            // Conecta ao Stream Público de Tickers da Binance (REAL DATA)
            ws = new WebSocket('wss://stream.binance.com:9443/ws/!ticker@arr');

            ws.onmessage = (event) => {
                let dados = JSON.parse(event.data);
                
                // Filtra apenas pares USDT com bom volume
                let paresRelevantes = dados.filter(m => m.s.endsWith('USDT') && parseFloat(m.q) > 1000000);
                
                // Ordena por volume (Top Coins)
                paresRelevantes.sort((a, b) => parseFloat(b.q) - parseFloat(a.q));
                
                // Pega o Top 30 para exibir na tela
                let top30 = paresRelevantes.slice(0, 30);
                
                atualizarTabela(top30);
                processarIA(top30); // Roda a IA nos dados reais
            };
        }

        function atualizarTabela(lista) {
            const tbody = document.getElementById('tabela-mercado');
            let html = "";

            lista.forEach(m => {
                let symbol = m.s.replace('USDT', '');
                let price = parseFloat(m.c).toFixed(2); // Preço Real
                let change = parseFloat(m.P).toFixed(2); // Variação Real
                
                let colorClass = change >= 0 ? "text-green" : "text-red";
                let sign = change >= 0 ? "+" : "";
                
                // Verifica se a IA deu sinal para essa moeda
                let acaoIA = verificarSinal(symbol, parseFloat(m.P));

                html += `
                    <tr>
                        <td>
                            <div style="display:flex; align-items:center;">
                                <div class="coin-icon">${symbol[0]}</div>
                                <span style="font-weight:700; color:white;">${symbol}</span>
                            </div>
                        </td>
                        <td>$ ${price}</td>
                        <td class="${colorClass}">${sign}${change}%</td>
                        <td>${acaoIA}</td>
                    </tr>
                `;
            });

            tbody.innerHTML = html;
        }

        // ===============================================
        // 4. LÓGICA DA IA (ESTRATÉGIA SOBRE DADOS REAIS)
        // ===============================================
        function verificarSinal(symbol, variacao) {
            // Se cair mais de 5% (Oportunidade de fundo)
            if (variacao < -5.0) {
                return `<span class="badge badge-buy">COMPRAR</span>`;
            } 
            // Se subir mais de 5% (Lucro rápido)
            else if (variacao > 5.0) {
                return `<span class="badge badge-sell">VENDER</span>`;
            }
            return `<span style="color:#444; font-size:11px; font-weight:bold;">MONITORANDO</span>`;
        }

        function processarIA(lista) {
            // Aqui a IA varre a lista real e "executa" os trades na banca do Firebase
            // Para não spamar, fazemos uma chance aleatória de execução baseada no sinal real
            
            lista.forEach(m => {
                let symbol = m.s.replace('USDT', '');
                let variacao = parseFloat(m.P);

                // Se achar uma moeda explodindo ou derretendo...
                if (Math.random() > 0.99) { // 1% de chance de executar o trade a cada tick (para não fazer 1000 trades por segundo)
                    if (variacao < -3) {
                        executarTrade(symbol, "COMPRA", variacao);
                    } else if (variacao > 3) {
                        executarTrade(symbol, "VENDA", variacao);
                    }
                }
            });
        }

        function executarTrade(simbolo, tipo, variacaoReal) {
            // Calcula lucro baseado na volatilidade REAL da moeda agora
            let multiplicador = Math.abs(variacaoReal) * 0.5; // Ex: Se variou 10%, lucro base de 5 reais
            let lucroOp = (Math.random() * 5) + multiplicador;

            banca += lucroOp;
            lucro += lucroOp;

            // Atualiza Painel
            document.getElementById('banca-display').innerText = `R$ ${banca.toFixed(2)}`;
            document.getElementById('lucro-display').innerText = `+R$ ${lucro.toFixed(2)}`;
            
            // Salva no Histórico do Firestore
            db.collection("historico_real").add({
                moeda: simbolo,
                acao: tipo,
                preco_momento: variacaoReal,
                lucro: lucroOp,
                data: new Date()
            });
        }

    </script>
</body>
</html>
